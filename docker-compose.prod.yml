services:
  contractorcalc:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "127.0.0.1:3002:3002"
    env_file: .env.production
    environment:
      - PORT=3002
    restart: unless-stopped
    networks:
      - perdiemify

  # One-off migration runner: docker compose -f docker-compose.prod.yml run --rm migrator
  migrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: migrator
    env_file: .env.production
    profiles:
      - tools
    networks:
      - perdiemify

networks:
  perdiemify:
    external: true
    name: infra_perdiemify
